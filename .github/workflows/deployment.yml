name: Deploy Hugo on GitHub Pages
on:
  push:
    branches: master

jobs:
  build:
    runs-on: ubuntu-20.04

    steps:
      - name: Checkout
        uses: actions/checkout@master
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          submodules: true

      - name: Hugo
        uses: crazy-max/ghaction-hugo@v1.3.3
        with:
          version: latest
          extended: false
          args: --minify --disableKinds RSS

      - name: Ossutil
        uses: frenchvandal/setup-ossutil@v3.0
        with:
          endpoint: "oss-eu-west-1.aliyuncs.com"
          access-key-id: "${{ secrets.OSS_ACCESS_KEY_ID }}"
          access-key-secret: "${{ secrets.OSS_ACCESS_KEY_SECRET }}"
          sts-token:
      - run:  ossutil cp -rf $GITHUB_WORKSPACE/public/ oss://normcore/ -u
